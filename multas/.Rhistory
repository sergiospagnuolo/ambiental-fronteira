d_transpose <- separate(d_transpose, 1, c("Ano", "Ambito", "Cargo", "Tipo", "Turno", "Cenario"), sep = "-", remove = FALSE)
d_transpose$Partido <- gsub(")", "", d_transpose$Partido, fixed = T)
d_transpose$Cenario <- gsub(".csv", "", d_transpose$Cenario, fixed = T)
d_transpose$Cenario <- gsub("(1)", "", d_transpose$Cenario, fixed = T)
d_transpose$Tipo <- gsub(".csv", "", d_transpose$Tipo, fixed = T)
d_transpose$Partido <- gsub("(", "", d_transpose$Partido, fixed = T)
d_transpose$Partido <- gsub(")", "", d_transpose$Partido, fixed = T)
d_transpose$Partido <- gsub("Nulos", "", d_transpose$Partido, fixed = T)
d_transpose$Partido <- gsub("Nulo", "", d_transpose$Partido, fixed = T)
d_transpose$Candidato <- gsub("Indecisos Brancos", "Indecisos Brancos Nulos", d_transpose$Candidato, fixed = T)
d_transpose$Candidato <- gsub("Brancos e", "Brancos e Nulos", d_transpose$Candidato, fixed = T)
d_transpose$Valor_pct <- gsub("-", NA, d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("n.d.", NA, d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("n.d", NA, d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("*", NA, d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("^$|^ $", NA, d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("%", "", d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub(",", ".", d_transpose$Valor_pct, fixed = T)
# ALTERNATIVA: d_transpose <- separate(d_transpose, Data_Pesquisa, c("Data_Inicial", "Data_Final"), sep = "-", remove = FALSE)
# Cria uma cópia da coluna de datas e manipula as datas para formato desejado
colnames(d_transpose)[8] <- "Data_Pesquisa"
d_transpose$Data_Referencia = d_transpose$Data_Pesquisa
d_transpose$Data_Pesquisa <- gsub(".*\\-", "",  d_transpose$Data_Pesquisa)
#d_transpose$Data_Pesquisa <- gsub(".*\\ a ", "",  d_transpose$Data_Pesquisa)
d_transpose <- d_transpose[,-1]
d_transpose$Data_Pesquisa <- gsub(".jan.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".fev.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".mar.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".abr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".mai.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(". mai.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".jun.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".jul.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".ago.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".agol.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".set.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".out.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".nov.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".dez.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# caso nome dos meses esteja nao abreviado
d_transpose$Data_Pesquisa <- gsub(".janeiro.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".fevereiro.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".março.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".abril.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".maio.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".junho.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".julho.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".agosto.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".setembro.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".outubro.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".novembro.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".dezembro.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# muda caixa alta-baixa
d_transpose$Data_Pesquisa <- gsub(".Jan.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Fev.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Mar.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Abr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Mai.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Jun.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Jul.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Ago.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Set.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Out.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Nov.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Dez.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# na eventualidade de meses abreviados em ingles
d_transpose$Data_Pesquisa <- gsub(".Feb.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Apr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".May.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Aug.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".aug.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Spt.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Oct.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Dec.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- as.POSIXct( d_transpose$Data_Pesquisa, format = "%e-%m-%y")
d_transpose <- d_transpose %>% filter(!is.na(Valor_pct))
d_transpose <- d_transpose %>% filter(Valor_pct == 0 | Valor_pct > 0)
View(d_transpose)
output <- paste(params$folder,params$prefixo,params$ano_eleicao,params$sufixo, sep = "")
# escreve o novo csv
write.table(d_transpose, file=output, quote = F, fileEncoding = "UTF-8", sep = ";", row.names=FALSE)
# remove tudo do workspace
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(rmarkdown)
library(knitr)
library(tidyverse)
library(shiny)
lockBinding("params", env = .GlobalEnv)
unlockBinding("params", env = .GlobalEnv)
metadados <- list.files(path = ".", pattern = "*.csv")
d_lista <- lapply(metadados, fread)
names(d_lista) <- metadados
d <- rbindlist(d_lista, idcol = "nome_arquivo", fill = T)
organizar <- function(d) {
d <- gather(d, Candidato_Partido, Valor_pct, -1:-3, factor_key = FALSE, na.rm = TRUE)
return(d)
}
# roda o script acima
d_transpose <- organizar(d)
# usa tydir para criar nova coluna com nome de candidato e de partido, e limpa tudo
d_transpose$Candidato_Partido <- gsub("(", "-", d_transpose$Candidato_Partido, fixed = T)
d_transpose <- separate(d_transpose, Candidato_Partido, c("Candidato", "Partido"), sep = "-", remove = FALSE)
#d_transpose$Partido <- gsub(")", "", d$Partido, fixed = T)
# d_transpose$Candidato_Partido = d_transpose$Candidato
# d_transpose$Candidato <- do.call(rbind, strsplit(d_transpose$Candidato, ' (?=[^ ]+$)', perl=TRUE))
#separa o nome dos arquivos como nome das colunas, e limpa células
d_transpose <- separate(d_transpose, 1, c("Ano", "Ambito", "Cargo", "Tipo", "Turno", "Cenario"), sep = "-", remove = FALSE)
d_transpose$Partido <- gsub(")", "", d_transpose$Partido, fixed = T)
d_transpose$Cenario <- gsub(".csv", "", d_transpose$Cenario, fixed = T)
d_transpose$Cenario <- gsub("(1)", "", d_transpose$Cenario, fixed = T)
d_transpose$Tipo <- gsub(".csv", "", d_transpose$Tipo, fixed = T)
d_transpose$Candidato_Partido <- gsub("-", "(", d_transpose$Candidato_Partido, fixed = T)
d_transpose$Valor_pct <- gsub("-", "", d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("n.d.", "", d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("n.d", "", d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("%", "", d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub(",", ".", d_transpose$Valor_pct, fixed = T)
# ALTERNATIVA: d_transpose <- separate(d_transpose, Data_Pesquisa, c("Data_Inicial", "Data_Final"), sep = "-", remove = FALSE)
# Cria uma cópia da coluna de datas e manipula as datas para formato desejado
colnames(d_transpose)[8] <- "Data_Pesquisa"
d_transpose$Data_Referencia = d_transpose$Data_Pesquisa
d_transpose$Data_Pesquisa <- gsub(".*\\-", "",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub(".*\\ a ", "",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("*", "",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("1°jul.2010", "1.jul.2010",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("1°out.2010", "1.out.2010",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("1°.out.2010", "1.out.2010",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("1°.set.2010", "1.out.2010",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("ag0", "ago",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/01/", "/jan/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/02/", "/fev/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/03/", "/mar/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/04/", "/abr/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/05/", "/mai/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/06/", "/jun/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/07/", "/jul/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/08/", "/ago/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/09/", "/set/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/10/", "/out/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/11/", "/nov/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/12/", "/dez/",  d_transpose$Data_Pesquisa)
d_transpose <- d_transpose[,-1]
# começa pelos anos
d_transpose$Data_Pesquisa <- gsub("/jan/", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/fev/", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/mar/", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/abr/", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/mai/", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/jun/", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/jul/", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/ago/", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/agol/", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/set/", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/out/", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/nov/", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/dez/", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# data separada por pontos
d_transpose$Data_Pesquisa <- gsub(".jan.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".fev.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".mar.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".abr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".mai.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".jun.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".jul.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".ago.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".agol.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".set.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".out.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".nov.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".dez.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# muda caixa alta-baixa
d_transpose$Data_Pesquisa <- gsub("/Jan/", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Fev/", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Mar/", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Abr/", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Mai/", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Jun/", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Jul/", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Ago/", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Set/", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Out/", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Nov/", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Dez/", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# muda caixa alta-baixa separada por pontos
d_transpose$Data_Pesquisa <- gsub(".Jan.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Fev.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Mar.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Abr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Mai.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Jun.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Jul.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Ago.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Set.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Out.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Nov.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Dez.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# na eventualidade de meses abreviados em ingles
d_transpose$Data_Pesquisa <- gsub("/Feb/", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Apr/", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/May/", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Aug/", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Spt/", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Oct/", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Dec/", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# na eventualidade de meses abreviados em ingles separado por pontos
d_transpose$Data_Pesquisa <- gsub(".Feb.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Apr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".May.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Aug.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Spt.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Oct.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Dec.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- as.POSIXct( d_transpose$Data_Pesquisa, format = "%e-%m-%Y")
d_transpose <- d_transpose %>% filter(!is.na(Valor_pct))
d_transpose <- d_transpose %>% filter(Valor_pct == 0 | Valor_pct > 0)
View(d_transpose)
output <- paste(params$folder,params$prefixo,params$ano_eleicao,params$sufixo, sep = "")
# escreve o novo csv
write.table(d_transpose, file=output, quote = F, fileEncoding = "UTF-8", sep = ";", row.names=FALSE)
# remove tudo do workspace
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(rmarkdown)
library(knitr)
library(tidyverse)
library(shiny)
lockBinding("params", env = .GlobalEnv)
unlockBinding("params", env = .GlobalEnv)
metadados <- list.files(path = ".", pattern = "*.csv")
d_lista <- lapply(metadados, fread)
names(d_lista) <- metadados
d <- rbindlist(d_lista, idcol = "nome_arquivo", fill = T)
organizar <- function(d) {
d <- gather(d, Candidato_Partido, Valor_pct, -1:-3, factor_key = TRUE)
return(d)
}
# roda o script acima
d_transpose <- organizar(d)
# usa tydir para criar nova coluna com nome de candidato e de partido, e limpa tudo
d_transpose$Candidato_Partido <- gsub("(", "-", d_transpose$Candidato_Partido, fixed = T)
d_transpose <- separate(d_transpose, Candidato_Partido, c("Candidato", "Partido"), sep = '-', remove = FALSE)
# d_transpose$Partido <- gsub(")", "", d$Partido, fixed = T)
# d_transpose$Candidato_Partido = d_transpose$Candidato
# d_transpose$Candidato <- do.call(rbind, strsplit(d_transpose$Candidato, ' (?=[^ ]+$)', perl=TRUE))
#separa o nome dos arquivos como nome das colunas, e limpa células
d_transpose <- separate(d_transpose, 1, c("Ano", "Ambito", "Cargo", "Tipo", "Turno", "Cenario"), sep = "-", remove = FALSE)
d_transpose$Partido <- gsub(")", "", d_transpose$Partido, fixed = T)
d_transpose$Cenario <- gsub(".csv", "", d_transpose$Cenario, fixed = T)
d_transpose$Cenario <- gsub("(1)", "", d_transpose$Cenario, fixed = T)
d_transpose$Tipo <- gsub(".csv", "", d_transpose$Tipo, fixed = T)
d_transpose$Candidato_Partido <- gsub("-", "(", d_transpose$Candidato_Partido, fixed = T)
d_transpose$Valor_pct <- gsub("-", "", d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("n.d.", "", d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("n.d", "", d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("%", "", d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub(",", ".", d_transpose$Valor_pct, fixed = T)
# ALTERNATIVA: d_transpose <- separate(d_transpose, Data_Pesquisa, c("Data_Inicial", "Data_Final"), sep = "-", remove = FALSE)
# Cria uma cópia da coluna de datas e manipula as datas para formato desejado
colnames(d_transpose)[8] <- "Data_Pesquisa"
d_transpose$Data_Referencia = d_transpose$Data_Pesquisa
d_transpose <- d_transpose[,-1]
d_transpose$Data_Pesquisa <- gsub(".*\\-", "",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub(".*\\ a ", "",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/01/", "/jan/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/02/", "/fev/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/03/", "/mar/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/04/", "/abr/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/05/", "/mai/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/06/", "/jun/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/07/", "/jul/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/08/", "/ago/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/09/", "/set/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/10/", "/out/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/11/", "/nov/",  d_transpose$Data_Pesquisa)
d_transpose$Data_Pesquisa <- gsub("/12/", "/dez/",  d_transpose$Data_Pesquisa)
# mais transformações de data
d_transpose$Data_Pesquisa <- gsub("/jan/", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/fev/", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/mar/", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/abr/", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/mai/", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/jun/", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/jul/", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/ago/", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/set/", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/out/", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/nov/", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/dez/", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# mais transformações de data Alta
d_transpose$Data_Pesquisa <- gsub("/JAN/", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/FEV/", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/MAR/", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/ABR/", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/MAI/", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/JUN/", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/JUL/", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/AGO/", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/SET/", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/OUT/", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/NOV/", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/DEZ/", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# muda caixa alta-baixa
d_transpose$Data_Pesquisa <- gsub(".Jan.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Fev.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Mar.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Abr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Mai.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Jun.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Jul.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Ago.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Set.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Out.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Nov.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Dez.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# caixa baixa
d_transpose$Data_Pesquisa <- gsub(".jan.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".fev.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".mar.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".abr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".abri.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".mai.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".jun.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".jul.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".ago.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".set.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".out.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".nov.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".dez.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
#caixa alta
d_transpose$Data_Pesquisa <- gsub(".JAN.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".FEV.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".MAR.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".ABR.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".MAI.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".JUN.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".JUL.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".AGO.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".SET.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".OUT.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".NOV.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".DEZ.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# na eventualidade de meses abreviados em ingles
d_transpose$Data_Pesquisa <- gsub(".Feb.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Apr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".May.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Aug.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".aug.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Sept.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Oct.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Dec.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# muda caixa alta-baixa
d_transpose$Data_Pesquisa <- gsub("/Jan/", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Fev/", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Mar/", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Abr/", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Mai/", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Jun/", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Jul/", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Ago/", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Set/", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Out/", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Nov/", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Dez/", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# na eventualidade de meses abreviados em ingles
d_transpose$Data_Pesquisa <- gsub("/Feb/", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Apr/", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/May/", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Aug/", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Spt/", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Oct/", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("/Dec/", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("16/set", "16-09-02",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("18/set", "18-09-02",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub("26/ago", "16-08-02",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- as.POSIXct( d_transpose$Data_Pesquisa, format = "%e-%m-%Y")
d_transpose <- d_transpose %>% filter(!is.na(Valor_pct))
d_transpose <- d_transpose %>% filter(Valor_pct == 0 | Valor_pct > 0)
View(d_transpose)
output <- paste(params$folder,params$prefixo,params$ano_eleicao,params$sufixo, sep = "")
# escreve o novo csv
write.table(d_transpose, file=output, quote = F, fileEncoding = "UTF-8", sep = ";", row.names=FALSE)
# remove tudo do workspace
# rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(rmarkdown)
library(knitr)
library(tidyverse)
library(shiny)
lockBinding("params", env = .GlobalEnv)
unlockBinding("params", env = .GlobalEnv)
metadados <- list.files(path = ".", pattern = "*.csv")
d_lista <- lapply(metadados, fread, fill = TRUE)
names(d_lista) <- metadados
d <- rbindlist(d_lista, idcol = "nome_arquivo", fill = T)
#adiciona coluna com valores aleatórios
d$id_cenario <- sample(1:999999, size = nrow(d), replace = F)
d <- cbind(id_cenario = sample(1:999999, size = nrow(d), replace = F), d)
organizar <- function(d) {
#transpoe linhas ecolunas
d <- gather(d, Candidato_Partido, Valor_pct, -1:-4, factor_key = FALSE)
return(d)
}
# roda o script acima
d_transpose <- organizar(d)
# usa tydir para criar nova coluna com nome de candidato e de partido, e limpa tudo
# d_transpose$Candidato_Partido <- gsub("(", "/", d_transpose$Candidato_Partido, fixed = T)
d_transpose$Candidato_Partido <- gsub("PC do B", "PCdoB", d_transpose$Candidato_Partido, fixed = T)
d_transpose$Candidato_Partido <- gsub("PC do B", "PCdoB", d_transpose$Candidato_Partido, fixed = T)
d_transpose$Candidato_Partido <- gsub("Psol", "PSOL", d_transpose$Candidato_Partido, fixed = T)
d_transpose$Candidato_Partido <- gsub("branco/ nulo", "Brancos/Nulos", d_transpose$Candidato_Partido, fixed = T)
d_transpose$Candidato_Partido <- gsub("Alckmin(PSDB)", "Alckmin PSDB", d_transpose$Candidato_Partido, fixed = T)
d_transpose <- separate(d_transpose, Candidato_Partido, c("Candidato", "Partido"), sep = ' (?=[^ ]+$)', remove = FALSE)
d_transpose <- separate(d_transpose, Candidato_Partido, c("Candidato", "Partido"), sep = ' (?=[^ ]+$)', remove = FALSE)
# d_transpose$Partido <- gsub(")", "", d$Partido, fixed = T)
# d_transpose$Candidato_Partido = d_transpose$Candidato
# d_transpose$Candidato <- do.call(rbind, strsplit(d_transpose$Candidato, ' (?=[^ ]+$)', perl=TRUE))
#separa o nome dos arquivos como nome das colunas, e limpa c??lulas
d_transpose <- separate(d_transpose, 1, c("Ano", "Ambito", "Cargo", "Tipo", "Turno", "Cenario"), sep = "-", remove = FALSE)
d_transpose$Partido <- gsub(")", "", d_transpose$Partido, fixed = T)
d_transpose$Cenario <- gsub(".csv", "", d_transpose$Cenario, fixed = T)
d_transpose$Cenario <- gsub("(1)", "", d_transpose$Cenario, fixed = T)
d_transpose$Tipo <- gsub(".csv", "", d_transpose$Tipo, fixed = T)
d_transpose$Partido <- gsub("(", "", d_transpose$Partido, fixed = T)
d_transpose$Partido <- gsub(")", "", d_transpose$Partido, fixed = T)
d_transpose$Partido <- gsub("nulos", "", d_transpose$Partido, fixed = T)
d_transpose$Partido <- gsub("nulo", "", d_transpose$Partido, fixed = T)
d_transpose$Partido <- gsub("respondeu", "", d_transpose$Partido, fixed = T)
d_transpose$Candidato <- gsub("Indecisos Brancos", "Indecisos Brancos Nulos", d_transpose$Candidato, fixed = T)
d_transpose$Candidato <- gsub("n??o sabe/ n??o", "n??o sabe/n??o respondeu", d_transpose$Candidato, fixed = T)
d_transpose$Candidato <- gsub("Brancos e", "Brancos e Nulos", d_transpose$Candidato, fixed = T)
d_transpose$Valor_pct <- gsub("-", NA, d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("n.d.", NA, d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("n.d", NA, d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("*", NA, d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("^$|^ $", NA, d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub("%", "", d_transpose$Valor_pct, fixed = T)
d_transpose$Valor_pct <- gsub(",", ".", d_transpose$Valor_pct, fixed = T)
# ALTERNATIVA: d_transpose <- separate(d_transpose, Data_Pesquisa, c("Data_Inicial", "Data_Final"), sep = "-", remove = FALSE)
# Cria uma c??pia da coluna de datas e manipula as datas para formato desejado
colnames(d_transpose)[8] <- "Data_Pesquisa"
d_transpose$Data_Referencia = d_transpose$Data_Pesquisa
d_transpose$Data_Pesquisa <- gsub(".*\\-", "",  d_transpose$Data_Pesquisa)
#d_transpose$Data_Pesquisa <- gsub(".*\\ a ", "",  d_transpose$Data_Pesquisa)
d_transpose <- d_transpose[,-1]
d_transpose$Data_Pesquisa <- gsub(".jan.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".fev.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".mar.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".abr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".mai.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(". mai.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".jun.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".jul.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".ago.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".agol.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".set.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".out.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".nov.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".dez.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# caso nome dos meses esteja nao abreviado
d_transpose$Data_Pesquisa <- gsub(".janeiro.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".fevereiro.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".mar??o.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".abril.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".maio.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".junho.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".julho.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".agosto.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".setembro.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".outubro.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".novembro.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".dezembro.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# muda caixa alta-baixa
d_transpose$Data_Pesquisa <- gsub(".Jan.", "-01-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Fev.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Mar.", "-03-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Abr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Mai.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Jun.", "-06-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Jul.", "-07-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Ago.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Set.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Out.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Nov.", "-11-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Dez.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
# na eventualidade de meses abreviados em ingles
d_transpose$Data_Pesquisa <- gsub(".Feb.", "-02-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Apr.", "-04-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".May.", "-05-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Aug.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".aug.", "-08-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Spt.", "-09-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Oct.", "-10-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- gsub(".Dec.", "-12-",  d_transpose$Data_Pesquisa, fixed = T)
d_transpose$Data_Pesquisa <- as.POSIXct( d_transpose$Data_Pesquisa, format = "%e-%m-%Y")
d_transpose <- d_transpose %>% filter(!is.na(Valor_pct))
d_transpose <- d_transpose %>% filter(Valor_pct == 0 | Valor_pct > 0)
View(d_transpose)
output <- paste(params$folder,params$prefixo,params$ano_eleicao,params$sufixo, sep = "")
# escreve o novo csv
write.table(d_transpose, file=output, quote = F, fileEncoding = "UTF-8", sep = ";", row.names=FALSE)
# remove tudo do workspace
# rm(list = ls())
setwd("~/data/ambiental-fronteira/multas")
install.packages("pdftables")
arquivos <- list.files(pattern = "pdf", full.names = T)
library(tabulizer)
install.packages("tabulizer")
library(tabulizer)
